<!DOCTYPE html>
<html>
<head>

	<meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    
    <!-- bootstrap引用cdn -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-F3w7mX95PdgyTmZZMECAngseQB83DfGTowi0iMjiWaeVhAn4FJkqJByhZMI3AhiU" crossorigin="anonymous" />
    <!-- 下載bootstrap引用 -->
    <!-- <link rel="stylesheet" href="vendors/bootstrap/bootstrap.min.css"> -->
    <link rel="stylesheet" href="css\official.css" />
    <link rel="stylesheet" href="css\front_navbar.css">

	<title>會員註冊表單</title>

</head>

<script src="../vendors/jquery/jquery-3.6.3.min.js"></script>
<script type="text/javascript">
    //在js中引入
    $(document).ready(function () {
        $('#nav_page').load('nav.html?ver=1');
    });
</script>

<body>
    <!-- 原本這裡放一大段nav.html原檔 自己開新檔案把原始碼放入用引入方式 -->
	<!-- <nav id="nav_page"></nav>
	<div id="blank_area"></div> -->

    
	<!-- 開始會員註冊頁面 -->
		<div class="memberregister">會員註冊</div>

		<!-- <p class="text-center">
			填寫資料 (請確保資料完整性)
		</p> -->

	<div class="text-center">
		<h1>會員註冊</h1>
		<h1>填寫資料 (請確保資料完整性)</h1>
	<form method="POST" action="http://localhost:8083/api/user/saveUser">
		<label>姓名：</label>
		<input type="text" id="username" name="username" required><br>

		<label>電子信箱 :</label>
		<input type="email" id="email" name="email" required><br>

		<label>地址：</label>
		<input type="text" id="address" name="address" required><br>

		<label>手機：</label>
		<input type="text" id="phoneNumber" name="phoneNumber" required><br>

		<label>密碼：</label>
		<input type="password" id="password" name="password" required><br>

		<label>確認密碼：</label>
		<input type="password" id="confirmpassword" name="confirmpassword" required><br>


		<!--<input type="submit" value="註冊">-->
		<input type="button" onclick="callAPI()" value="註冊">
		<button type="button" class="btn_back">回到首頁</button>
		
	</form>


	<script src="../vendors/jquery/jquery-3.6.3.min.js"></script>
    <!-- bootstrap引用cdn -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-/bQdsTh/da6pkI1MST/rWKFNjaCP5gBSY4sEBT38Q/9RBh9AH40zEOg7Hlq2THRZ" crossorigin="anonymous">
        </script>
    <!-- 下載bootstrap引用 -->
    <!-- <script src="./vendors/bootstrap/bootstrap.bundle.min.js" integrity="sha384-/bQdsTh/da6pkI1MST/rWKFNjaCP5gBSY4sEBT38Q/9RBh9AH40zEOg7Hlq2THRZ" crossorigin="anonymous"
    ></script> -->
    <script src="js/front_navbar.js"></script>


	<script>
		const backButton = document.querySelector(".btn_back");
		backButton.addEventListener("click", function () {
		  // 在這裡編寫按鈕點擊後的處理邏輯，比如返回上一頁
		  window.location.href = "homepage.html";
		});
	  </script>


 <script>
	function callAPI() {
		var email = $('#email').val();
		var username = $('#username').val();
		var password = $('#password').val();
		var confirmpassword = $('#confirmpassword').val();
		var address = $('#address').val();
		var phoneNumber = $('#phoneNumber').val();
		
		var error = true;
      if (password != confirmpassword ){
        alert("密碼與確認密碼不一致，請重新輸入。")
        error = false;
      }
      if(username == null || username == ""){
        alert("名字不可為空白!")
        error = false;
      }
      if (address == null || address == ""){
        alert("地址不可為空白!")
        error = false;
      }
      if(phoneNumber == null || phoneNumber == ""){
        alert("手機不可為空白!")
        error = false;
      }
      if(password == null || password == "" || confirmpassword == null || confirmpassword == "") {
        alert("密碼或確認密碼不得為空!")
        error = false; 
      }

		var check = true;
		if(email==''){
			alert('請輸入電子信箱');
			$('input#email').focus();
			return (check=false);
		}else{
			var emailRegxp = /^[a-zA-Z][a-zA-Z0-9]{5,15}@[a-zA-Z0-9]+([a-zA-Z0-9]+\.)+([a-zA-Z0-9]{2,4})$/;

			if (emailRegxp.test(email) != true){
				alert('電子信箱格式錯誤');
				$("input#email").focus();
				$("input#email").select();
				return (check=false);
			}
		}
		if(password ==''){
			alert('請輸入密碼');
			$('input#password').focus();
			return check=false;
		}else{
			var passwordRegxp = /^(?=.*[A-Za-z])(?=.*\d)[A-Za-z\d]{8,}$/; 
			if (passwordRegxp.test(password) != true){
				alert('密碼格式錯誤');
				alert('密碼必須包含至少一個字母和一個數字，長度至少為8位');
				$("input#password").focus();
				$("input#password").select();
				return check=false;
			}
		}
		if(check){
			$.ajax({
				url: "register",
				method: "POST",
				dataType : 'json', // 預期從server接收的資料型態
				  contentType : "application/json", // 要送到server的資料型態
				data: JSON.stringify({
					email:email,
					username:username,
					password:password,
					confirmpassword:confirmpassword,
					address:address,
					phoneNumber:phoneNumber
				}),
				success: function(response) {
					// 成功註冊完後TODO
					alert(response.message);
					if(response.message == "註冊成功"){
						$(location).attr("href","success.html");
					}
				},
				error: function(error) {
					alert("Error calling API: " + error);
				}
			});

		}
	}
</script> 

</body>
</html>