<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- bootstrap引用cdn -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-F3w7mX95PdgyTmZZMECAngseQB83DfGTowi0iMjiWaeVhAn4FJkqJByhZMI3AhiU"
      crossorigin="anonymous"
    />
    <!-- 下載bootstrap引用 -->
    <!-- <link rel="stylesheet" href="vendors/bootstrap/bootstrap.min.css"> -->
    <link rel="stylesheet" href="css/official.css" />
    <link rel="stylesheet" href="css/register.css" />

    <title>會員註冊表單</title>
  </head>

  <script src="../vendors/jquery/jquery-3.6.3.min.js"></script>
  <script type="text/javascript">
    //在js中引入
    $(document).ready(function () {
      $("#nav_page").load("nav.html?ver=1");
    });
  </script>

  <body>
    <div class="banner-container">
      <div class="banner-content">
        <h1 class="text-center">會員註冊</h1>
        <h2 class="text-center">填寫資料 (請確保資料完整性)</h2>
        <form>
          <div class="form-group">
            <label for="username">姓名：</label>
            <input
              type="text"
              id="username"
              name="username"
              class="form-control"
              required
            />
          </div>
          <div class="form-group">
            <label for="email">電子信箱 :</label>
            <input
              type="email"
              id="email"
              name="email"
              class="form-control"
              required
            />
          </div>
          <div class="form-group">
            <label for="address">地址：</label>
            <input
              type="text"
              id="address"
              name="address"
              class="form-control"
              required
            />
          </div>
          <div class="form-group">
            <label for="phoneNumber">手機：</label>
            <input
              type="text"
              id="phoneNumber"
              name="phoneNumber"
              class="form-control"
              required
            />
          </div>
          <div class="form-group">
            <label for="password">密碼：</label>
            <input
              type="password"
              id="password"
              name="password"
              class="form-control"
              required
            />
          </div>
          <div class="form-group">
            <label for="confirmpassword">確認密碼：</label>
            <input
              type="password"
              id="confirmpassword"
              name="confirmpassword"
              class="form-control"
              required
            />
          </div>
          <div class="button-wrapper text-center">
            <button type="button" class="register">註冊</button>
            <button type="button" class="btn_back">回到首頁</button>
          </div>
        </form>
      </div>
    </div>

    <script src="../vendors/jquery/jquery-3.6.3.min.js"></script>
    <!-- bootstrap引用cdn -->
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-/bQdsTh/da6pkI1MST/rWKFNjaCP5gBSY4sEBT38Q/9RBh9AH40zEOg7Hlq2THRZ"
      crossorigin="anonymous"
    ></script>
    <!-- 下載bootstrap引用 -->
    <!-- <script src="./vendors/bootstrap/bootstrap.bundle.min.js" integrity="sha384-/bQdsTh/da6pkI1MST/rWKFNjaCP5gBSY4sEBT38Q/9RBh9AH40zEOg7Hlq2THRZ" crossorigin="anonymous"
    ></script> -->
    <script src="js/front_navbar.js"></script>

    <script>
      const backButton = document.querySelector(".btn_back");
      backButton.addEventListener("click", function () {
        // 在這裡編寫按鈕點擊後的處理邏輯，比如返回上一頁
        window.location.href = "homepage.html";
      });
    </script>

    <script>
      function memberRegister() {
        var email = $("#email").val();
        var username = $("#username").val();
        var password = $("#password").val();
        var confirmpassword = $("#confirmpassword").val();
        var address = $("#address").val();
        var phoneNumber = $("#phoneNumber").val();

        var error = true;
        var remind = [];
        if (password != confirmpassword) {
          remind.push("密碼與確認密碼不一致，請重新輸入。");
          error = false;
        }
        if (username == null || username == "") {
          remind.push("名字不可為空白!");
          error = false;
        }
        if (address == null || address == "") {
          remind.push("地址不可為空白!");
          error = false;
        }
        if (phoneNumber == null || phoneNumber == "") {
          remind.push("手機不可為空白!");
          error = false;
        }
        if (
          password == null ||
          password == "" ||
          confirmpassword == null ||
          confirmpassword == ""
        ) {
          remind.push("密碼或確認密碼不得為空!");
          error = false;
        }
        if (remind.length != 0) {
          alert(remind);
          remind = [];
        }

        if (username == "") {
          alert("請輸入姓名");
          $("input#username").focus();
          return (error = false);
        } else {
          var nameRegxp = /^([A-Za-z]+[\s]?[A-Za-z]+)|([\u4e00-\u9fa5]{2,4})$/;
          if (nameRegxp.test(username) != true) {
            alert("姓名格式錯誤");
            alert(
              "只能是英文或中文，英文名字之間可以有空格，中文名字長度介於2至4個字元"
            );
            $("input#username").focus();
            $("input#username").select();
            return (error = false);
          }
        }
        if (email == "") {
          alert("請輸入電子信箱");
          $("input#email").focus();
          return (error = false);
        } else {
          var emailRegxp =
            /^[a-zA-Z][a-zA-Z0-9]{5,15}@[a-zA-Z0-9]+([a-zA-Z0-9]+\.)+([a-zA-Z0-9]{2,4})$/;

          if (emailRegxp.test(email) != true) {
            alert("電子信箱格式錯誤");
            alert("開頭必須為英文字母搭配數字加上@");
            $("input#email").focus();
            $("input#email").select();
            return (error = false);
          }
        }
        if (password == "") {
          alert("請輸入密碼");
          $("input#password").focus();
          return (error = false);
        } else {
          var passwordRegxp = /^(?=.*[A-Za-z])(?=.*\d)[A-Za-z\d]{8,20}$/;
          if (passwordRegxp.test(password) != true) {
            alert("密碼格式錯誤");
            alert("密碼必須包含至少一個字母和一個數字，長度至少為8位");
            $("input#password").focus();
            $("input#password").select();
            return (error = false);
          }
        }
        if (error) {
          $.ajax({
            url: "register",
            method: "POST",
            dataType: "json", // 預期從server接收的資料型態
            contentType: "application/json", // 要送到server的資料型態
            data: JSON.stringify({
              email: email,
              username: username,
              password: password,
              confirmpassword: confirmpassword,
              address: address,
              phoneNumber: phoneNumber,
            }),
            success: function (response) {
              // 成功註冊完後TODO
              alert(response.message);
              if (response.message == "註冊成功") {
                $(location).attr("href", "success.html");
              }
            },
            error: function (error) {
              alert("Error calling API: " + error);
            },
          });
        }
      }
      $("button.register").on("click", function () {
        memberRegister();
      });
    </script>
  </body>
</html>
